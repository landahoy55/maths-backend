{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","status","send","register","username","body","email","name","password","err","account","authenticate","session","scope","logout","get","json","user","findById","params","id"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAEC;;AAEDA,QAAIC,IAAJ,CAAS,OAAT,EAAkB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5BA,YAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,OAArB;AACH,KAFD;;AAIA;AACA;AACAL,QAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChC,0BAAQG,QAAR,CAAiB,sBAAc,EAACC,UAAUL,IAAIM,IAAJ,CAASC,KAApB,EAA2BC,MAAMR,IAAIM,IAAJ,CAASE,IAA1C,EAAd,CAAjB,EACIR,IAAIM,IAAJ,CAASG,QADb,EAEI,UAASC,GAAT,EAAcC,OAAd,EAAuB;AACnB,gBAAID,GAAJ,EAAS;AACLT,oBAAIE,IAAJ,CAASO,GAAT;AACH;AACD,+BAASE,YAAT,CACI,OADJ,EACa;AACLC,yBAAS;AADJ,aADb,EAGOb,GAHP,EAGYC,GAHZ,EAGiB,YAAM;AACfA,oBAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,8BAArB;AACP,aALD;AAMP,SAZD;AAaH,KAdD;;AAgBA;AACA;AACAL,QAAIC,IAAJ,CAAS,QAAT,EAAmB,mBAASa,YAAT,CACf,OADe,EACN;AACLC,iBAAS,KADJ;AAELC,eAAO;AAFF,KADM,CAAnB;;AAOA;AACA;AACA;AACA;AACA;AACA;;AAEAhB,QAAIC,IAAJ,CAAS,MAAT,8BAA6B,mBAASa,YAAT,CACzB,OADyB,EAChB;AACLC,iBAAS,KADJ;AAELC,eAAO;AAFF,KADgB,CAA7B;;AAOA;AACA;AACAhB,QAAIC,IAAJ,CAAS,SAAT,gCAAkC,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5CA,YAAIc,MAAJ;AACAd,YAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,yBAArB;AACH,KAHD;;AAKA;AACAL,QAAIkB,GAAJ,CAAQ,KAAR,gCAA6B,UAAChB,GAAD,EAAMC,GAAN,EAAc;AACvCA,YAAIC,MAAJ,CAAW,GAAX,EAAgBe,IAAhB,CAAqBjB,IAAIkB,IAAzB;AACH,KAFD;;AAIA;AACApB,QAAIkB,GAAJ,CAAQ,cAAR,gCAAsC,UAAChB,GAAD,EAAMC,GAAN,EAAc;AAChD,0BAAQkB,QAAR,CAAiBnB,IAAIoB,MAAJ,CAAWC,EAA5B,EAAgC,UAACX,GAAD,EAAMC,OAAN,EAAkB;AAC9C,gBAAID,GAAJ,EAAS;AACLT,oBAAIE,IAAJ,CAASO,GAAT;AACH;AACDT,gBAAIgB,IAAJ,CAASN,OAAT;AACH,SALD;AAMH,KAPD;;AASA,WAAOb,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\n\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate, checkAdmin} from '../middleware/authMiddleware';\n\nexport default ({ config, db }) => {\n    let api = Router();\n\n     //login in admin\n\n    api.post('/test', (req, res) => {\n        res.status(200).send('HERE!');\n    });\n\n    //Register\n    // v1/account\n    api.post('/register', (req, res) => {\n        Account.register(new Account(  {username: req.body.email, name: req.body.name}),\n            req.body.password,\n            function(err, account) {\n                if (err) {\n                    res.send(err);\n                }\n                passport.authenticate(\n                    'local', {\n                        session: false\n                    })(req, res, () => {\n                        res.status(200).send('Successfully created account');\n                });\n        });\n    });\n\n    //Login\n    // v1/account/login\n    api.post('/login', passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }), generateAccessToken, respond\n    );\n\n    // api.post('/weblogin', passport.authenticate(\n    //     'local', {\n    //         session: false,\n    //         scope: []\n    //     }), generateAccessToken, respond\n    // );\n\n    api.post('/web', checkAdmin, passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }), generateAccessToken, respond\n    );\n\n    //Logout\n    // v1/account/logout\n    api.post('/logout', authenticate, (req, res) => {\n        res.logout();\n        res.status(200).send('Successfully logged out');\n    });\n\n    //Request user info - get ID\n    api.get('/me', authenticate, (req, res) => {\n        res.status(200).json(req.user);\n    });\n\n    //Retreive user information - ie, name\n    api.get('/details/:id', authenticate, (req, res) => {\n        Account.findById(req.params.id, (err, account) => {\n            if (err) {\n                res.send(err)\n            }\n            res.json(account);\n        });\n    });\n\n    return api;\n}"]}